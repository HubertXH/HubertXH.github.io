<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  

  <!-- Baidu Tongji -->
  

  <!-- Baidu Push -->
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="随笔小记"/>
  <meta name="keyword" content="IT"/>
  <link rel="shortcut icon" href="/img/avatar/02.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="http://yoursite-url/Linux/System-IO-Monitor/">
  <title>
    
      Linux系统IO相关 - null
    
  </title>
<meta name="generator" content="Hexo 5.4.2"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--light">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'light';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">风闲小聚</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">HOME</a>
          </li>

          
          
          
          
          <li>
            <a href="/categories/">
              
              CATEGORIES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              ARCHIVES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/about/">
              
              ABOUT
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              TAGS
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>SEARCH</a>
          </li>
          

          <!-- LangSelect -->
          
          
          
          
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/mountCloud.jpg');
      --intro-header-background-image-url-post: url('/img/header_img/Linux.jpg');
      --intro-header-background-image-url-page: url('//img/header_img/Linux.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/mountCloud.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/Linux.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/header_img/Linux.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/header_img/Linux.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#IO Monitor Index" title="IO Monitor Index">IO Monitor Index</a>
              
            </div>
            <h1>Linux系统IO相关</h1>
            <h2 class="subheading">Linux系统IO性能监控指标</h2>
            <span class="meta">
              Posted by 煦阳 on
              2022-05-07
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">9</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">2.2k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <h1>系统IO监控指标</h1>
<ul>
<li>top</li>
<li>vmstat</li>
<li>iostat</li>
<li>iotop</li>
<li>pt-ioprofile</li>
<li>pidstat</li>
</ul>
<h4 id="top">top</h4>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">top - 13:43:42 up<span class="number"> 1070 </span>days, 22:27, <span class="number"> 1 </span>user,  load average: 2.91, 5.01, 6.93</span><br><span class="line">Tasks:<span class="number"> 209 </span>total,  <span class="number"> 1 </span>running,<span class="number"> 208 </span>sleeping,  <span class="number"> 0 </span>stopped,  <span class="number"> 0 </span>zombie</span><br><span class="line">%Cpu(s):  3.7 us,  1.1 sy,  0.0 ni, 95.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :<span class="number"> 32374620 </span>total,  <span class="number"> 223024 </span>free, <span class="number"> 7064456 </span>used,<span class="number"> 25087140 </span>buff/cache</span><br><span class="line">KiB Swap:<span class="number"> 67071996 </span>total,<span class="number"> 65133684 </span>free, <span class="number"> 1938312 </span>used.<span class="number"> 24497028 </span>avail Mem </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>指标解释：
<ul>
<li>us, user    : nice值为0的用户进程占用CPU时间百分比</li>
<li>sy, system  : 系统内核占用CPU的时间百分比</li>
<li>ni, nice    : nice不为0的用户进程占用CPU时间百分比</li>
<li>id, idle    : CUP空闲时间百分比</li>
<li>wa, IO-wait : 等待IO时间</li>
<li>hi : 硬中断耗费的时间百分比</li>
<li>si : 软中断耗费的时间百分比</li>
<li>st : 虚拟机管理程序从此虚拟机窃取的时间</li>
</ul>
</li>
</ul>
<p>在这里我们主要关注 wa 数值，如果改指标的数值较高则说明有大量的IO占用。</p>
<hr>
<h4 id="vmstat">vmstat</h4>
<table>
    <tr>
        <td colspan="2">Procs</td>
        <td colspan="4">Memory</td>
        <td colspan="2">Swap</td>
        <td colspan="2">IO</td>
        <td colspan="2">System</td>
        <td colspan="5">Cpu</td>
    </tr>
    <tr>
        <td>r</td>
        <td>b</td>
        <td>swpd</td>
        <td>free</td>
        <td>buff</td>
        <td>cache</td>
        <td>si</td>
        <td>so</td>
        <td>bi</td>
        <td>bo</td>
        <td>in</td>
        <td>cs</td>
        <td>us</td>
        <td>sy</td>
        <td>id</td>
        <td>wa</td>
        <td>st</td>
    </tr>
    <tr>
        <td>0</td>
        <td>0</td>
        <td>691</td>
        <td>19393</td>
        <td>325</td>
        <td>11282</td>
        <td>0</td>
        <td>0</td>
        <td>1</td>
        <td>35</td>
        <td>0</td>
        <td>0</td>
        <td>3</td>
        <td>1</td>
        <td>96</td>
        <td>0</td>
        <td>0</td>
    </tr>
</table>
<ul>
<li>指标解释
<ul>
<li>
<p>Procs</p>
<ul>
<li>r: 列表示运行和等待cpu时间片的进程数，如果长期大于1，说明cpu不足，需要增加cpu，数量越大，系统越繁忙。</li>
<li>b: 表示在等待资源的进程数，比如正在等待I/O、或者内存交换等，数量越大，系统越繁忙。</li>
</ul>
</li>
<li>
<p>Memory</p>
<ul>
<li>swpd: 虚拟内存已使用的大小，如果大于0，或者比较大需要注意系统内存够，如果si、so的值长期为0，系统性能还是正常。</li>
<li>free: 当前的空闲页面列表中内存数量。</li>
<li>buff: Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存。</li>
<li>cache: 作为page cache的内存数量，一般作为文件系统的cache，如果cache较大，说明用到cache的文件较多，如果此时IO中bi比较小，说明文件系统效率比较好。</li>
<li>inact: 非活动内存的数量。（-a选项）</li>
<li>active: 活动内存的数量。（-a选项）</li>
</ul>
</li>
<li>
<p>Swap</p>
<ul>
<li>si: 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉</li>
<li>so: 每秒虚拟内存写入磁盘的大小。如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉</li>
</ul>
</li>
<li>
<p>IO</p>
<ul>
<li>bi: 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备.</li>
<li>bo: 块设备每秒发送的块数量，例如我们读取文件，这里我们设置的bi+bo参考值为1000，如果超过1000，而且wa值较大应该考虑均衡磁盘负载，可以结合iostat输出来分析。</li>
</ul>
</li>
<li>
<p>System</p>
<ul>
<li>in: 每秒CPU的中断次数，包括时间中断。</li>
<li>cs: 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目.</li>
</ul>
</li>
<li>
<p>CPU</p>
<ul>
<li>us: 用户进程占用CPU时间包含nice和非nice进程，us的值比较高时，说明用户进程消耗的cpu时间多，但是如果长期大于50%，需要考虑优化用户的程序。</li>
<li>sy: 内核进程所花费的cpu时间的百分比。这里us + sy的参考值为80%，如果us+sy 大于 80%说明可能存在CPU不足。</li>
<li>id: 空闲 CPU时间，一般来说，id + us + sy = 100 .</li>
<li>wa: 等待IO<br>
CPU时间。这里wa的参考值为30%，如果wa超过30%，说明IO等待严重，这可能是磁盘大量随机访问造成的，也可能磁盘或者磁盘访问控制器的带宽瓶颈造成的(<br>
主要是块操作)。</li>
<li>st: 虚拟机管理程序从此虚拟机窃取的时间 .</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="iostat">iostat</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>显示CPU使用情况</td>
</tr>
<tr>
<td>-d</td>
<td>显示磁盘使用情况</td>
</tr>
<tr>
<td>-k</td>
<td>已KB为单位显示统计信息</td>
</tr>
<tr>
<td>-M</td>
<td>以MB为单位显示统计信息</td>
</tr>
<tr>
<td>-n</td>
<td>显示NFS使用统计信息</td>
</tr>
<tr>
<td>-p</td>
<td>显示设备块及其分区统计信息</td>
</tr>
<tr>
<td>-t</td>
<td>打印时间</td>
</tr>
<tr>
<td>-x</td>
<td>显示额外统计信息</td>
</tr>
</tbody>
</table>
<p>设备利用指标解释</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Linux</span> <span class="number">3</span>.<span class="number">10</span>.<span class="number">0</span>-<span class="number">1160</span>.<span class="number">42</span>.<span class="number">2</span>.el<span class="number">7</span>.x<span class="number">86</span>_<span class="number">64</span> (server<span class="number">2</span>) 	<span class="number">04</span>/<span class="number">25</span>/<span class="number">2023</span> 	_x<span class="number">86</span>_<span class="number">64</span>_	(<span class="number">8</span> CPU)</span><br><span class="line"></span><br><span class="line"><span class="attribute">Device</span>:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line"><span class="attribute">sda</span>               <span class="number">0</span>.<span class="number">00</span>     <span class="number">2</span>.<span class="number">13</span>    <span class="number">0</span>.<span class="number">03</span>    <span class="number">1</span>.<span class="number">12</span>     <span class="number">0</span>.<span class="number">41</span>    <span class="number">23</span>.<span class="number">23</span>    <span class="number">40</span>.<span class="number">87</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">75</span>    <span class="number">7</span>.<span class="number">23</span>    <span class="number">0</span>.<span class="number">56</span>   <span class="number">0</span>.<span class="number">09</span>   <span class="number">0</span>.<span class="number">01</span></span><br><span class="line"><span class="attribute">sda1</span>              <span class="number">0</span>.<span class="number">00</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">00</span>     <span class="number">0</span>.<span class="number">01</span>     <span class="number">0</span>.<span class="number">00</span>   <span class="number">151</span>.<span class="number">24</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">6</span>.<span class="number">12</span>    <span class="number">6</span>.<span class="number">37</span>    <span class="number">0</span>.<span class="number">92</span>   <span class="number">5</span>.<span class="number">49</span>   <span class="number">0</span>.<span class="number">00</span></span><br><span class="line"><span class="attribute">sda2</span>              <span class="number">0</span>.<span class="number">00</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">00</span>     <span class="number">0</span>.<span class="number">00</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">89</span>.<span class="number">85</span>     <span class="number">0</span>.<span class="number">00</span>   <span class="number">15</span>.<span class="number">35</span>   <span class="number">15</span>.<span class="number">35</span>    <span class="number">0</span>.<span class="number">00</span>  <span class="number">13</span>.<span class="number">40</span>   <span class="number">0</span>.<span class="number">00</span></span><br><span class="line"><span class="attribute">sda3</span>              <span class="number">0</span>.<span class="number">00</span>     <span class="number">2</span>.<span class="number">13</span>    <span class="number">0</span>.<span class="number">03</span>    <span class="number">1</span>.<span class="number">12</span>     <span class="number">0</span>.<span class="number">40</span>    <span class="number">23</span>.<span class="number">23</span>    <span class="number">40</span>.<span class="number">85</span>     <span class="number">0</span>.<span class="number">00</span>    <span class="number">0</span>.<span class="number">75</span>    <span class="number">7</span>.<span class="number">23</span>    <span class="number">0</span>.<span class="number">56</span>   <span class="number">0</span>.<span class="number">09</span>   <span class="number">0</span>.<span class="number">01</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>指标名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Device</td>
<td>设备名</td>
</tr>
<tr>
<td>2</td>
<td>rrqm/s</td>
<td>每秒这个设备相关的读取请求有多少被Merge了（当系统调用需要读取数据的时候，VFS将请求发到各个FS，如果FS发现不同的读取请求读取的是相同Block的数据，FS会将这个请求合并Merge）</td>
</tr>
<tr>
<td>3</td>
<td>wrqm/s</td>
<td>每秒这个设备相关的写入请求有多少被Merge了</td>
</tr>
<tr>
<td>4</td>
<td>r/s</td>
<td>设备块每秒钟的读请求数</td>
</tr>
<tr>
<td>5</td>
<td>w/s</td>
<td>设备块每秒钟的写请求数</td>
</tr>
<tr>
<td>6</td>
<td>rkB(MB)/s</td>
<td>每秒钟从设备块读取的数据大小单位为KB/MB</td>
</tr>
<tr>
<td>7</td>
<td>wkB(MB)/s</td>
<td>每秒钟向设备块写入的数据大小单位为KB/MB</td>
</tr>
<tr>
<td>8</td>
<td>avgrq-sz</td>
<td>每个IO请求的请求的扇区数量</td>
</tr>
<tr>
<td>9</td>
<td>avgqu-sz</td>
<td>等待设备块处理的IO请求的等待队列大小（越小越好）</td>
</tr>
<tr>
<td>10</td>
<td>await</td>
<td>每一个IO请求的处理时间，包含等待和数据处理</td>
</tr>
<tr>
<td>11</td>
<td>svctm</td>
<td>平均每个IO请求的数据处理时间-不准确</td>
</tr>
<tr>
<td>12</td>
<td>%util</td>
<td>处理IO请求的时间占比，此数值越高说明磁盘的负载越高。</td>
</tr>
</tbody>
</table>
<p>补充说明：</p>
<ul>
<li>%utils:<br>
在统计时间内所有处理IO时间除以总共统计时间。例如，如果统计间隔1秒，该设备有0.8秒在处理IO，而0.2秒闲置，那么该设备的%util =<br>
0.8/1 = 80%，所以该参数暗示了设备的繁忙程度<br>
。一般地，如果该参数是100%表示设备已经接近满负荷运行了（当然如果是多磁盘，即使%util是100%，因为磁盘的并发能力，所以磁盘使用未必就到了瓶颈）。</li>
<li>avgrq-sz:统计时间段内平均下来，这段时间内，所有请求的平均大小，单位是扇区，即（512字节）。</li>
</ul>
<p>常见用法：</p>
<ul>
<li>iostat -d 1 5 统计磁盘信息，每秒钟统计一次，共统计5次</li>
<li>iostat -dxm 2 5 统计磁盘使用信息，每2秒钟统计一次，共统计5次，输出扩展信息，信息输出的单位为MB</li>
</ul>
<h4 id="iotop">iotop</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-o</td>
<td>只展示进行IO的线程或进程（默认展示全部），通过展示页面按o键可以进行动态切换</td>
</tr>
<tr>
<td>-b</td>
<td>打开非交互模式</td>
</tr>
<tr>
<td>-n</td>
<td>统计N次后退出</td>
</tr>
<tr>
<td>-d</td>
<td>统计周期，即d秒钟统计一次</td>
</tr>
<tr>
<td>-p</td>
<td>后接PID,监控某一个进程或线程的IO</td>
</tr>
<tr>
<td>-u</td>
<td></td>
</tr>
<tr>
<td>-P</td>
<td>只展示进程（默认展示所有进程和线程）</td>
</tr>
<tr>
<td>-a</td>
<td>展示积累量而非流量大小</td>
</tr>
<tr>
<td>-k</td>
<td>以KB为单位展示</td>
</tr>
<tr>
<td>-t</td>
<td>打印时间</td>
</tr>
</tbody>
</table>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PID</span> | PRIO | USER | DISK READ(读) | DISK WRITE(写) | SWAPIN | IO(IO占比) | COMMAND</span><br><span class="line"><span class="attribute">914</span>   be/<span class="number">3</span>   root |  <span class="number">0</span>.<span class="number">00</span> B/s     | <span class="number">815</span>.<span class="number">33</span> B/s    | <span class="number">0</span>.<span class="number">00</span> % | <span class="number">0</span>.<span class="number">02</span> %  |<span class="meta"> [jbd2/vdb-8]</span></span><br><span class="line"><span class="attribute">319</span>   be/<span class="number">3</span>   root |  <span class="number">0</span>.<span class="number">00</span> B/s     | <span class="number">0</span>.<span class="number">00</span> B/s      | <span class="number">0</span>.<span class="number">00</span> % | <span class="number">0</span>.<span class="number">02</span> %  |<span class="meta"> [jbd2/vda1-8]</span></span><br><span class="line"><span class="attribute">420</span>   be/<span class="number">4</span>   root |  <span class="number">0</span>.<span class="number">00</span> B/s     | <span class="number">19</span>.<span class="number">11</span> K/s     | <span class="number">0</span>.<span class="number">00</span> % | <span class="number">0</span>.<span class="number">00</span> %  | java -Xms<span class="number">1024</span>m -Xmx<span class="number">1024</span>m -server</span><br></pre></td></tr></table></figure>
<p>常用示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 每两秒钟进行一次统计，共统计5次，只输出进行IO的进程</span></span><br><span class="line">iotop -n 5 -d 2 -oP</span><br><span class="line"><span class="meta">#</span><span class="bash"> 非交互式统计信息</span></span><br><span class="line">iotop -d 2 -oP -b</span><br></pre></td></tr></table></figure>
<h4 id="pidstat">pidstat</h4>
<p>本文章内，此命令我们只关注-d参数的输出结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 监听PID为 19693的进程，每2秒钟输出一次信息，共输出5次信息</span></span><br><span class="line">pidstat -d -p 19693 2 5</span><br></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">03</span>:<span class="number">25</span>:<span class="number">56</span> PM       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command</span><br><span class="line"><span class="attribute">03</span>:<span class="number">25</span>:<span class="number">58</span> PM     <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">1692</span>.<span class="number">00</span>     <span class="number">10</span>.<span class="number">00</span>  java</span><br><span class="line"><span class="attribute">03</span>:<span class="number">26</span>:<span class="number">00</span> PM     <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">3072</span>.<span class="number">00</span>     <span class="number">28</span>.<span class="number">00</span>  java</span><br><span class="line"><span class="attribute">03</span>:<span class="number">26</span>:<span class="number">02</span> PM     <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">1562</span>.<span class="number">00</span>      <span class="number">0</span>.<span class="number">00</span>  java</span><br><span class="line"><span class="attribute">03</span>:<span class="number">26</span>:<span class="number">04</span> PM     <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">1878</span>.<span class="number">00</span>      <span class="number">0</span>.<span class="number">00</span>  java</span><br><span class="line"><span class="attribute">03</span>:<span class="number">26</span>:<span class="number">06</span> PM     <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">2566</span>.<span class="number">00</span>     <span class="number">82</span>.<span class="number">00</span>  java</span><br><span class="line"><span class="attribute">Average</span>:        <span class="number">19693</span>      <span class="number">0</span>.<span class="number">00</span>   <span class="number">2154</span>.<span class="number">00</span>     <span class="number">24</span>.<span class="number">00</span>  java</span><br></pre></td></tr></table></figure>
<p>kB_rd/s:每秒钟写入磁盘的数据量-单位KB<br>
kB_wr/s:每秒钟从磁盘读取的数据量-单位KB<br>
kB_ccwr/s: 每秒钟被取消写入到磁盘的数据量-单位KB<br>
Command: 对应的命令</p>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/TechSoltion/SwitchToSharding/" data-toggle="tooltip" data-placement="top" title="单库单表切换至分表">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/RocketMQ/OperationMaintenance/" data-toggle="tooltip" data-placement="top" title="RocketMQ运维相关">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=Linux系统IO相关&body=Hi,I found this website and thought you might like it http://yoursite-url/Linux/System-IO-Monitor/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: '',
      id: 'Sat May 07 2022 15:13:42 GMT+0800', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      language: 'en',
      proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">系统IO监控指标</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#top"><span class="toc-nav-number">1.0.0.1.</span> <span class="toc-nav-text">top</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vmstat"><span class="toc-nav-number">1.0.0.2.</span> <span class="toc-nav-text">vmstat</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#iostat"><span class="toc-nav-number">1.0.0.3.</span> <span class="toc-nav-text">iostat</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#iotop"><span class="toc-nav-number">1.0.0.4.</span> <span class="toc-nav-text">iotop</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#pidstat"><span class="toc-nav-number">1.0.0.5.</span> <span class="toc-nav-text">pidstat</span></a></li></ol></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#IO Monitor Index" title="IO Monitor Index">IO Monitor Index</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://v-vincen.life/" target="_blank">HubertXH</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/HubertXH">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          煦阳
          2024
          <br>
          Theme by
          <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          <!--
          re-Ported by
          <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe> -->
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  
    <!-- LangSelect start -->
    <script type="text/javascript" src="/js/langselect.js"></script>
    <!-- LangSelect end -->
  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF,#6666CC,#663399,#66CC99,#FF0033'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("http://yoursite-url/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="SEARCH..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
