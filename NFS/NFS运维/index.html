<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  

  <!-- Baidu Tongji -->
  

  <!-- Baidu Push -->
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="随笔小记"/>
  <meta name="keyword" content="IT"/>
  <link rel="shortcut icon" href="/img/avatar/02.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="http://yoursite-url/NFS/NFS运维/">
  <title>
    
      NFS运维操作 - null
    
  </title>
<meta name="generator" content="Hexo 5.4.2"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--light">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'light';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">风闲小聚</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">HOME</a>
          </li>

          
          
          
          
          <li>
            <a href="/about/">
              
              ABOUT
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              ARCHIVES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/categories/">
              
              CATEGORIES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              TAGS
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>SEARCH</a>
          </li>
          

          <!-- LangSelect -->
          
          
          
          
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/mountCloud.jpg');
      --intro-header-background-image-url-post: url('/img/header_img/dp.jpg');
      --intro-header-background-image-url-page: url('//img/header_img/dp.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/mountCloud.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/dp.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('//img/header_img/dp.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('/img/header_img/dp.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
            </div>
            <h1>NFS运维操作</h1>
            <h2 class="subheading"></h2>
            <span class="meta">
              Posted by 煦阳 on
              2023-08-27
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">10</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">2.6k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <h3 id="安装">安装</h3>
<h4 id="服务端操作">服务端操作</h4>
<ul>
<li>使用yum命令安装nfs-utils和rpcbind软件包：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install nfs-utils rpcbind</span></span><br></pre></td></tr></table></figure>
<ul>
<li>启动并设置开机自启rpcbind和nfs服务：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> --now rpcbind</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> --now nfs-server</span></span><br></pre></td></tr></table></figure>
<ul>
<li>编辑/etc/exports文件，添加要导出的目录和客户端IP范围, NFS服务器是通过配置/etc/exports这个文件进行，设定格式如下：</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 分享目录        主机名称或者<span class="type">IP</span>(参数<span class="number">1</span>，参数<span class="number">2</span>）</span><br><span class="line"> /<span class="class"><span class="keyword">data</span>/share    10.22.22.*(<span class="title">rw</span>,<span class="title">sync</span>,<span class="title">no_root_squash</span>)</span></span><br><span class="line"> </span><br><span class="line">这表示允许<span class="number">10.22</span><span class="number">.22</span> 网段的客户端以读写方式挂载/<span class="class"><span class="keyword">data</span>/share目录，</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rw</td>
<td>可读写的权限</td>
</tr>
<tr>
<td>ro</td>
<td>只读的权限</td>
</tr>
<tr>
<td>no_root_squash</td>
<td>登入到NFS主机的用户如果是root，该用户即拥有root权限</td>
</tr>
<tr>
<td>root_squash</td>
<td>登入NFS主机的用户如果是root，该用户权限将被限定为匿名使用者nobody</td>
</tr>
<tr>
<td>all_squash</td>
<td>共享文件的UID和GID映射匿名用户nobody，适合公用目录</td>
</tr>
<tr>
<td>no_all_squash</td>
<td>保留共享文件的UID和GID（默认）</td>
</tr>
<tr>
<td>subtree_check</td>
<td>如果共享/usr/bin之类的子目录时，强制NFS检查父目录的权限（默认）</td>
</tr>
<tr>
<td>no_subtree_check</td>
<td>如果共享/usr/bin之类的子目录时，不检查父目录权限</td>
</tr>
<tr>
<td>sync</td>
<td>资料同步写入存储器中</td>
</tr>
<tr>
<td>async</td>
<td>资料会先暂时存放在内存中，不会直接写入硬盘</td>
</tr>
<tr>
<td>secure</td>
<td>NFS通过1024以下的安全TCP/IP端口发送</td>
</tr>
<tr>
<td>insecure</td>
<td>允许从这台机器过来的非授权访问</td>
</tr>
<tr>
<td>wdelay</td>
<td>如果多个用户要写入NFS目录，则归组写入（默认）</td>
</tr>
<tr>
<td>no_wdelay</td>
<td>如果多个用户要写入NFS目录，则立即写入，当使用async时，无需此设置</td>
</tr>
<tr>
<td>hide</td>
<td>在NFS共享目录中不共享其子目录</td>
</tr>
<tr>
<td>no_hide</td>
<td>共享NFS目录的子目录</td>
</tr>
</tbody>
</table>
<ul>
<li>exportfs 命令</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>全部mount或者unmount /etc/exports中的内容</td>
</tr>
<tr>
<td>-r</td>
<td>重新mount /etc/ exports中分享出来的目录</td>
</tr>
<tr>
<td>-u</td>
<td>umount 目录</td>
</tr>
<tr>
<td>-v</td>
<td>在 export 的时候，将详细的信息输出到屏幕上</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 是NFS配置生效</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo exportfs -a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 全部重新<span class="built_in">export</span>一次</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo exportfs -rv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 全部卸载</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo exportfs -au</span></span><br></pre></td></tr></table></figure>
<h4 id="客户端操作">客户端操作</h4>
<ul>
<li>client 安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install nfs-utils</span><br></pre></td></tr></table></figure>
<p>使用mount命令挂载服务端的共享目录，常用的参数说明如下:</p>
<ul>
<li>-a :挂载/etc/fstab文件中所有的文件系统。</li>
<li>-t fs :指定文件系统的类型,如ext3、ext4、xfs等。</li>
<li>-o options :指定挂载时的选项,如async、noexec等。</li>
<li>-l :列出当前系统已挂载的文件系统。</li>
<li>-r :只读方式挂载文件系统。</li>
<li>-w :可读写方式挂载文件系统。</li>
<li>-L label :通过卷标挂载文件系统。</li>
<li>-U uuid :通过uuid挂载文件系统。</li>
<li>-B blockdevice :将外部设备挂载上。</li>
<li>-c :检查设备是否已挂载,已挂载则跳过。</li>
<li>-f :强制挂载。</li>
<li>-n :不写入/etc/mtab文件。</li>
<li>-v :详细模式,输出详细信息。</li>
<li>-o loop :以循环设备的方式挂载文件。</li>
<li>-o sync :以同步I/O方式挂载文件系统。</li>
</ul>
<p>例如:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4 -o defaults <span class="regexp">/dev/</span>sda1 <span class="regexp">/mnt/</span>disk</span><br></pre></td></tr></table></figure>
<p>挂载ext4文件系统的/dev/sda1分区到/mnt/disk目录。<br>
掌握mount参数可以更灵活的管理文件系统的挂载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /mount/point 目录必须先创建好</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mount -t nfs hostname(orIP):/directory /mount/point</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这表示将192.168.0.1的/tmp 目录挂载到本地的/mnt/nfs目录。</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mount -t nfs 192.168.0.1:/tmp /mnt/nfs</span> </span><br></pre></td></tr></table></figure>
<ul>
<li>在客户端或服务端对NFS目录进行卸载操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载本地的/mnt/data目录。</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo umount /mnt/data</span></span><br></pre></td></tr></table></figure>
<ul>
<li>showmout命令简单介绍:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> showmount 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum -y install showmount</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看192.168.1.136服务器上<span class="built_in">export</span>出来的目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo showmount -e 192.168.1.136</span> </span><br></pre></td></tr></table></figure>
<ul>
<li>客户端日志路径:/var/log/message,NFS有什么问题可以查看此日志</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>这个参数是一般在NFS SERVER上使用，是用来显示已经mount上本机nfs目录的cline机器。</td>
</tr>
<tr>
<td>-e</td>
<td>显示指定的NFS SERVER上export出来的目录。</td>
</tr>
</tbody>
</table>
<h3 id="服务器启动自动挂载">服务器启动自动挂载</h3>
<ul>
<li>修改/etc/fstab文件实现自动挂载：</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">file</span> System       dir          Type    Options         dump pass </span><br><span class="line"><span class="attribute">LABEL</span>=/           /            ext<span class="number">3</span>    defaults        <span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="attribute">tmpfs</span>             /dev/shm     tmpfs   defaults        <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="attribute">devpts</span>            /dev/pts     devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="attribute">sysfs</span>             /sys         sysfs   defaults        <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="attribute">proc</span>              /proc        proc    defaults        <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"><span class="attribute">LABEL</span>=SWAP-vda<span class="number">2</span>   swap         swap    defaults        <span class="number">0</span>    <span class="number">0</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>列名</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>file System</td>
<td>要挂载的分区或存储设备. 设备名称，LABEL，UUID，伪文件系统名称</td>
</tr>
<tr>
<td>dir</td>
<td>挂载位置</td>
</tr>
<tr>
<td>type</td>
<td>要挂载设备或是分区的文件系统类型  同理参考mount命令-t参数的说明</td>
</tr>
<tr>
<td>options</td>
<td>挂在时命令参数可以查看mount命令对应的参数</td>
</tr>
<tr>
<td>dump</td>
<td>是否进行备份0-不进行，1-每天进行一次，2-不定时进行备份</td>
</tr>
<tr>
<td>pass</td>
<td>是否进行文件系统检查以及检查顺序，0-不进行检查，1,2为检查数字越小优先级越高。如果配置为开机检查则如果检查不通过则无法正常开机</td>
</tr>
</tbody>
</table>
<ul>
<li>修改/etc/rc.d/rc.local文件实现自动挂载：</li>
</ul>
<ol>
<li>在文件中写入：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t nfs -o _netdev remoteAddress:/directory /localDir</span><br><span class="line">mount -t nfs mtnfs.idc4:/usr/local/tomcat_mtnfs/webapps/picturefiles /var/www/merchant/images/picturefiles</span><br><span class="line">mount --bind /var/www/merchant/images/picturefiles/ /var/www/merchant/images/file/</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>rc.local文件增加执行权限：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x rc.local</span><br></pre></td></tr></table></figure>
<h3 id="常见错误：">常见错误：</h3>
<h4 id="rpcbind-错误">rpcbind 错误</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount.nfs: rpc.statd is not running but is required for remote locking.</span><br><span class="line">mount.nfs: Either use &#x27;-o nolock&#x27; to keep locks local, or start statd.</span><br><span class="line">mount.nfs: an incorrect mount option was specified</span><br></pre></td></tr></table></figure>
<p>rpcbind未启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpcbind 状态查看</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/rpcbind status</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpcbind 启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/rpcbind start</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rpcbind 停止</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/rpcbind stop</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo service portmap start</span></span><br></pre></td></tr></table></figure>
<h4 id="目录不可用">目录不可用</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot open directory .: Stale file handle</span><br></pre></td></tr></table></figure>
<p>解决方法卸载目录后重新挂载</p>
<h4 id="卸载目录时报device-is-busy">卸载目录时报device is busy</h4>
<p>在 Linux 中执行 umount 命令时遇到 device is busy 错误,代表正在尝试卸载的文件系统或磁盘仍在使用中,常见的原因包括:</p>
<ol>
<li>有进程正在访问此文件系统或者磁盘中的文件。可以用 lsof 命令查看。</li>
<li>有目录挂载在此文件系统下面,需要先卸载子目录。</li>
<li>用户当前正处于此文件系统的目录下,需要先退出。</li>
<li>有程序持有此文件系统上的文件句柄未释放。</li>
<li>挂载点目录为空但被进程锁住,可以删除目录后重试。</li>
<li>该文件系统为根文件系统,系统必须关机才能卸载。</li>
</ol>
<p>对应的解决方法是:</p>
<ol>
<li>结束访问文件系统的进程。</li>
<li>先卸载子挂载点。</li>
<li>退出文件系统目录。</li>
<li>找到并关闭占用文件的程序。</li>
<li>删除挂载点目录。</li>
<li>在单用户模式下卸载根文件系统。</li>
</ol>
<p>此外也可以添加 -f 参数强制卸载,但可能导致数据丢失或文件系统损坏,需谨慎使用。<br>
需要根据具体情况分析文件系统正在被哪些应用或进程占用,从而采取对应措施释放文件系统。</p>
<h4 id="NFS-server-xxx-error-fileid-changed">NFS: server xxx error: fileid changed</h4>
<p>在NFS客户端看到&quot;NFS: server xxx error: fileid changed&quot;这类错误信息,通常是由于NFS服务器端导出目录中的文件被删除或移动后又重新创建所导致的。</p>
<p>主要原因是:</p>
<ul>
<li>NFS客户端缓存了文件句柄(fileid)到文件路径的映射关系。</li>
<li>如果服务器端目录文件被删除或者移动,文件句柄会变化。</li>
<li>但客户端缓存的老句柄在一段时间内仍然有效。</li>
<li>当客户端尝试使用老的缓存文件句柄读取文件时,会发现文件ID不匹配,于是出现这个错误。</li>
</ul>
<p>可以通过以下方式解决:</p>
<ul>
<li>在服务器端导出目录避免频繁删除/移动重建文件。</li>
<li>在客户端访问NFS目录前,使用umount强制卸载该目录,这样可以清除缓存的句柄信息,避免错误。</li>
<li>设置NFS的acdirmax和acdirmin缓存时间,让客户端更快更新变化的文件信息。</li>
<li>升级NFS客户端和服务器到最新稳定版本,以解决可能的已知Bug。</li>
<li>检查网络质量,避免断开重连导致客户端重新请求时文件信息已失效。</li>
</ul>
<p>如果问题持续出现,还需要检查NFS服务器端文件系统 one-true-readdir属性是否被错误禁用,以及检查客户端和服务端的NFS配置参数是否合理。</p>
<h3 id="其他">其他</h3>
<h4 id="NFS的防火墙配置">NFS的防火墙配置</h4>
<p>通过命令rpcinfo -p 可查看nfs使用的端口：<br>
其中 portmapper，nfs 服务端口是固定的分别是 111和2049；<br>
另外 rquotad，nlockmgr，mountd 服务端口是随机的。由于端口是随机的，这导致防火墙无法设置。<br>
这时需要配置/etc/sysconfig/nfs 使 rquotad，nlockmgr，mountd 的端口固定。<br>
找到以下几项，将前面的#号去掉。</p>
<pre><code>LOCKD_TCPPORT=32803
LOCKD_UDPPORT=32769
MOUNTD_PORT=892
</code></pre>
<h4 id="NFS客户升级">NFS客户升级</h4>
<ol>
<li>检查当前NFS客户端的版本,例如通过rpm -qa|grep nfs-utils来查看。</li>
<li>选择目标升级的版本,通常建议升级到当前平台最新稳定的NFS utils版本。</li>
<li>在升级前把所有挂载的NFS目录都卸载掉,以防进程还在使用旧版本的nfs程序。可以用mount或者df -T命令查看已经挂载的NFS目录。</li>
<li>使用yum update或者适当的包管理器更新nfs-utils包到最新版本。</li>
<li>更新后检查/sbin/下的nfs程序文件时间判断是否更新成功。</li>
<li>对于主版本升级,可能还需要更新/etc/idmapd.conf等配置文件 to 新版默认设置。</li>
<li>升级完成后重新挂载NFS目录,可以用mount -a命令。</li>
<li>做一些访问测试,确认客户端可以正常工作。</li>
<li>最后查看/var/log/messages等日志,确认没有报错信息。</li>
</ol>
<h4 id="更换nfs-utils安装包版本">更换nfs-utils安装包版本</h4>
<ol>
<li>使用rpm -qa|grep nfs-utils命令查看当前系统中nfs-utils包的版本。</li>
<li>根据需要,确定目标替换的nfs-utils版本。通常建议升级到当前系统发行版的最新稳定版本。</li>
<li>使用yum search nfs-utils命令搜索可用的nfs-utils版本。</li>
<li>卸载旧版本的nfs-utils包:yum remove nfs-utils</li>
<li>清除旧版本的缓存和配置文件:<br>
rm -rf /var/lib/nfs<br>
rm /etc/sysconfig/nfs</li>
<li>安装新版本的nfs-utils包:<br>
yum install nfs-utils-版本号</li>
<li>重新配置nfs服务的配置文件,确保与新版本匹配。</li>
<li>重启相关服务:<br>
systemctl restart nfs-server</li>
<li>测试nfs功能是否正常。</li>
<li>检查日志确保没有错误。</li>
</ol>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          <li class="previous">
            <a href="/Nginx/NgConfig/" data-toggle="tooltip" data-placement="top" title="NginxConfig">&larr; Previous Post</a>
          </li>
          
          
          <li class="next">
            <a href="/Linux/ApplicationMonitor/" data-toggle="tooltip" data-placement="top" title="应用监控脚本">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=NFS运维操作&body=Hi,I found this website and thought you might like it http://yoursite-url/NFS/NFS运维/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: '',
      admin: '',
      id: 'Sun Aug 27 2023 20:30:31 GMT+0800', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      language: 'en',
      proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token'
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
          <li>
            <a href="https://v-vincen.life/" target="_blank">HubertXH</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/HubertXH">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          煦阳
          2024
          <br>
          Theme by
          <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          <!--
          re-Ported by
          <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe> -->
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  
    <!-- LangSelect start -->
    <script type="text/javascript" src="/js/langselect.js"></script>
    <!-- LangSelect end -->
  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF,#6666CC,#663399,#66CC99,#FF0033'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("http://yoursite-url/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="SEARCH..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
